# 京都検定クイズアプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
京都検定の過去問題を活用した4択クイズアプリを開発し、友人5人程度で学習・練習できる環境を提供する。

### 1.2 対象ユーザー
- 京都検定の受験を目指す学習者
- 想定利用人数: 5人程度

### 1.3 技術スタック
- **フロントエンド**: React (TypeScript)
- **データ形式**: JSON
- **PDF解析**: Python
- **ホスティング**: 静的ホスティング（GitHub Pages / Netlify / Cloudflare Pages）
- **データ保存**: LocalStorage

---

## 2. 機能要件

### 2.1 問題データ

#### 2.1.1 データソース
- 京都検定過去問題PDF（`contents/過去問題/`に格納）
- 第1回 2級・3級 全200問

#### 2.1.2 問題分類
- **難易度**: 1級 / 2級 / 3級
- **カテゴリ**: 歴史、史跡、神 社、寺院、建築、庭園、美術、伝統工芸、伝統文化、花街、祭と行事、京料理、京菓子、ならわし、ことばと伝説、地名、自然、観光学
- **回答形式**: 4択（選択肢4つから1つ選択）

#### 2.1.3 問題データ構造
各問題には以下の情報を含む：
- 問題ID
- 難易度（1級 / 2級 / 3級）
- カテゴリ
- 試験実施年月日
- 問題文
- 選択肢4つ
- 正解
- 解説文

---

### 2.2 出題形式

#### 2.2.1 クイズ開始フロー
1. **難易度選択**: 1級 / 2級 / 3級 を選択
2. **出題数選択**: 10問 / 100問 を選択
3. **クイズ開始**: ランダムに選択された問題が出題される

#### 2.2.2 出題ルール
- 選択された難易度の問題からランダムに出題
- 同じ問題の重複出題なし（1セッション内）
- カテゴリはランダムミックス

---

### 2.3 回答・フィードバック機能

#### 2.3.1 回答フロー
1. 4つの選択肢から1つを選択
2. 選択後、即時に正解/不正解をフィードバック

#### 2.3.2 正解時
- 正解の表示（コンパクトなテキスト形式、ボタンに見えないデザイン）
- 正解の選択肢を緑色でハイライト
- 「この問題が間違っていることを報告する」ボタン表示
- 次の問題へ進むボタン表示（画面下部固定）

#### 2.3.3 不正解時
- 不正解の表示（コンパクトなテキスト形式、ボタンに見えないデザイン）
- 正解の選択肢を緑色でハイライト
- 誤答の選択肢を赤色で表示
- 解説文を表示（スクロール可能）
- 「この問題が間違っていることを報告する」ボタン表示
- 次の問題へ進むボタン表示（画面下部固定、スクロール時も常に表示）

#### 2.3.4 UI/UXの配慮
- **「次の問題」ボタンは画面下部に固定配置**（`position: sticky`）
  - スマートフォンでスクロール不要でボタンにアクセス可能
  - 解説が長文でもボタンが隠れない設計
- **フィードバックメッセージはコンパクトに表示**
  - ボタンのような大きなボックスではなく、テキストベースの表示
  - 誤操作を防ぐための視覚的明瞭性

#### 2.3.5 問題の間違い報告機能

**目的**: 問題データに誤りがある場合、ユーザーが報告し、開発者が確認・修正できる仕組み

**報告フロー**:
1. フィードバック画面（正解時・不正解時）に「この問題が間違っていることを報告する」ボタンを表示
2. ボタンをクリックすると、問題IDと報告情報をLocalStorageに記録
3. 報告後は「報告済み」と表示（同一セッション内で再報告可能）

**データ保存**:
- LocalStorageキー: `kyoto-kentei-question-reports`
- JSON形式で問題ID、報告回数、報告日時を保存

**管理者向け機能**:
- 管理者用ページ（`/admin`など）で報告データを一覧表示
- JSON形式でエクスポート（ダウンロード）機能
- 開発者が報告データを確認し、questions.jsonを手動で修正・削除

**UI/UX配慮**:
- ボタンは控えめなデザイン（誤クリック防止）
- 報告は匿名（個人情報の収集なし）
- スパム防止は初期段階では不要（利用者5人程度）

#### 2.3.6 時間制限
- 時間制限なし（自分のペースで回答可能）

---

### 2.4 スコア・結果表示機能

#### 2.4.1 結果サマリー
全問題回答後に以下を表示：
- 正答数 / 全問題数
- 正答率（パーセンテージ）
- 各カテゴリ別の正答率
- 苦手なカテゴリの特定と表示

#### 2.4.2 苦手分析
- カテゴリ別正答率を計算
- 正答率が低いカテゴリを「苦手なカテゴリ」として表示
- 復習を促すメッセージ

---

### 2.5 データ保存

#### 2.5.1 LocalStorage利用
- 過去のクイズ結果を保存
- カテゴリ別の累積正答率を記録
- デバイス単位での保存（クロスデバイス同期なし）

---

## 3. 非機能要件

### 3.1 UI/UX

#### 3.1.1 デバイス対応
- **スマホ対応必須**: レスポンシブデザイン
- タッチ操作に最適化
- 画面サイズ: 375px〜対応

#### 3.1.2 デザイン方針
- シンプルで視認性の高いデザイン
- 問題文が読みやすいフォントサイズ
- ボタンは指で押しやすいサイズ（最低44px×44px）

### 3.2 パフォーマンス
- 初回ロード時間: 3秒以内
- 問題切り替え: 即座に表示

### 3.3 ネットワーク
- オンライン環境でのみ動作
- オフライン対応は不要

### 3.4 ブラウザ対応
- Chrome (最新版)
- Safari (最新版)
- Firefox (最新版)
- Edge (最新版)

---

## 4. システム構成

### 4.1 アーキテクチャ

```
┌─────────────────────────────────────┐
│   静的ホスティング                    │
│   (GitHub Pages/Netlify/Cloudflare) │
└─────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────┐
│   React SPA (TypeScript)            │
│   - クイズUI                         │
│   - 結果表示                         │
│   - LocalStorage管理                │
└─────────────────────────────────────┐
                 │
                 ▼
┌─────────────────────────────────────┐
│   public/data/questions.json        │
│   (問題データ)                       │
└─────────────────────────────────────┘
```

### 4.2 開発フロー

```
PDF → Python解析スクリプト → questions.json → Reactアプリに組み込み → デプロイ
```

---

## 5. データスキーマ

### 5.1 questions.json

```json
{
  "questions": [
    {
      "id": "q001",
      "level": "3級",
      "category": "歴史",
      "exam-year": "2004/12/12",
      "question": "延暦13年(794)、桓武天皇は( )から、平安京に新しい都を遷した。",
      "options": [
        "長岡京",
        "平城京",
        "難波京",
        "藤原京"
      ],
      "correctAnswer": 0,
      "explanation": "桓武天皇は**長岡京**から新しい都の平安京に遷都しました。桓武天皇は三つの都を経験しており、長岡京では藤原種継暗殺事件や早良親王の怨霊の祟りなどの問題があり、平安京への再遷都が行われました。 [cite: 111-125, 126]"
    }
  ]
}
```

### 5.2 LocalStorage データ構造

```typescript
// クイズ履歴
interface QuizHistory {
  id: string;
  date: string;
  level: "1級" | "2級" | "3級";
  totalQuestions: number;
  correctAnswers: number;
  categoryResults: {
    [category: string]: {
      correct: number;
      total: number;
    }
  }
}

// 累積統計
interface CumulativeStats {
  [category: string]: {
    correct: number;
    total: number;
    accuracy: number;
  }
}

// 問題の間違い報告データ
interface QuestionReport {
  questionId: string;      // 問題ID
  reportCount: number;     // 報告回数
  firstReportedAt: string; // 初回報告日時（ISO 8601形式）
  lastReportedAt: string;  // 最終報告日時（ISO 8601形式）
}

interface QuestionReportsData {
  reports: QuestionReport[];
}

// LocalStorageキー
// - kyoto-kentei-quiz-history: QuizHistory[]
// - kyoto-kentei-cumulative-stats: CumulativeStats
// - kyoto-kentei-question-reports: QuestionReportsData
```

---

## 6. 画面遷移

```
起動画面
   ↓
難易度選択画面 (2級 / 3級)
   ↓
出題数選択画面 (10問 / 100問)
   ↓
クイズ画面 (問題1/10)
   ↓ (回答)
フィードバック画面 (正解 or 不正解+解説)
   ↓ (次へ)
クイズ画面 (問題2/10)
   ↓ (繰り返し)
結果画面 (スコア・カテゴリ別正答率・苦手分析)
   ↓
起動画面に戻る / もう一度挑戦
```

---

## 7. 画面一覧

### 7.1 ユーザー向け画面
1. ホーム画面
2. 難易度選択画面
3. 出題数選択画面
4. クイズ画面
5. フィードバック画面（報告ボタン付き）
6. 結果画面
7. 過去の成績画面

### 7.2 管理者向け画面
8. 管理者ページ（`/admin`）
   - 問題の間違い報告一覧表示
   - 報告データのJSON形式エクスポート（ダウンロード）
   - 報告データのクリア機能

---

## 8. 今後の拡張可能性（Phase 2以降）

- ユーザー認証機能
- 友人間でのスコア共有・ランキング
- 問題のブックマーク機能
- 間違えた問題の復習モード
- より詳細な統計情報（学習進捗グラフなど）
- オフライン対応（PWA化）
- 管理者ページの認証機能

---

## 9. 制約事項

- ユーザー認証なし（LocalStorageのみ）
- デバイス間でのデータ同期なし
- 問題の追加・更新は再デプロイが必要
- 同時接続数制限なし（静的ファイルのため）
- 管理者ページは認証なし（初期実装）

---

## 10. 開発スケジュール（目安）

| フェーズ | 内容 | 期間 |
|---------|------|------|
| Phase 1 | Python PDF解析スクリプト開発 | 1-2日 |
| Phase 2 | questions.json生成・検証 | 1日 |
| Phase 3 | React プロジェクトセットアップ | 0.5日 |
| Phase 4 | UI コンポーネント実装 | 2-3日 |
| Phase 5 | ロジック実装（クイズ・結果表示） | 2日 |
| Phase 6 | テスト・デバッグ | 1-2日 |
| Phase 7 | デプロイ | 0.5日 |

**合計**: 7-11日程度

---

## 11. 成果物

1. Python PDF解析スクリプト (`scripts/parse_pdf.py`)
2. 問題データJSON (`public/data/questions.json`)
3. Reactアプリケーション
4. デプロイ済みWebアプリケーション（公開URL）
5. README.md（セットアップ・使い方）
6. 管理者ページ（問題報告データの確認・エクスポート機能）

---

## 付録: カテゴリ分類例

PDFから抽出された問題を以下のカテゴリに分類：

- **寺社・仏閣**: 清水寺、金閣寺、銀閣寺、伏見稲荷大社など
- **料理**: 京料理、和菓子、茶道など
- **行事**: 祇園祭、時代祭、葵祭など
- **文化**: 伝統工芸、芸能、文学など
- **歴史**: 平安時代、室町時代、明治維新など
- **建築**: 庭園、町家、建築様式など
- **地理**: 京都の地名、川、山など
- **その他**: 上記に分類できないもの

※カテゴリは問題内容を解析して自動または手動で分類
